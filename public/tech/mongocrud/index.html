<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">



<link rel="icon" type="image/ico" href="http://localhost:1313//favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313//favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313//favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http://localhost:1313//android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313//apple-touch-icon.png">

<meta name="description" content="Learn how to create a quick and easy CRUD API"/>

<title>
    
    Creating a CRUD API with Go and MongoDB | Siddharth Tewari
    
</title>

<link rel="canonical" href="http://localhost:1313/tech/mongocrud/"/>












<link rel="stylesheet" href="/assets/combined.min.ad2f3027caeae43af660fffc18eff13bdb057131c21b6865a450a78ce7cfa61b.css" media="all">





  </head>

  

  
  
  

  <body class="auto">

    <div class="content">
      <header>
        

<div class="header">

    

    <h1 class="header-title">Siddharth Tewari</h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/linkstash" >
                /linkstash
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/tech" >
                /tech
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/articles" >
                /articles
            </a>
        </p>
        
        
    </div>

    

</div>

      </header>

      <main class="main">
        





<div class="breadcrumbs">
    
    <a href="/">Home</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a href="/tech/">Tech</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a class="breadcrumbs-current" href="/tech/mongocrud/">Creating a CRUD API with Go and MongoDB</a>
</div>



<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">Creating a CRUD API with Go and MongoDB</h1>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2023-03-20T00:00:00&#43;00:00">March 20, 2023</time>
      

      
    </p>

  </div>

  

  

  

  

  <div class="single-content">
    <h1 id="setup">Setup</h1>
<p>A CRUD API or a Create-Read-Update-Delete API is one of the first steps you take in your journey exploring the world of backend development.</p>
<p>Get started with Golang by installing it on your computer if you haven’t already done so.</p>
<p>This tutorial will require some basic knowledge of golang.</p>
<p>Next we will install the packages needed for creating the CRUD API. We&rsquo;ll be using Gin Gonic to route the API endpoints.</p>
<pre tabindex="0"><code>go get github.com/gin-gonic/gin
</code></pre><p>Now we install the mongoDB driver:</p>
<pre tabindex="0"><code>go get go.mongodb.org/mongo-driver/mongo
</code></pre><h1 id="directory-structure">Directory Structure</h1>
<p>This is what your project directory should look like.</p>
<pre tabindex="0"><code>.
├── Collection
│   └── getCollection.go
├── databases
│   └── database.go
├── go.mod
├── go.sum
├── main.go
├── model
│   └── model.go
└── routes
    ├── create.go
    ├── delete.go
    ├── read.go
    └── update.go
</code></pre><h1 id="connecting-mongodb-to-go">Connecting MongoDB to Go</h1>
<p>All you need is your local mongoDB URI to connect to your DB. It typically looks a little like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>Mongo_URI = <span style="color:#5af78e">&#34;mongodb://127.0.0.1:27017&#34;</span>
</span></span></code></pre></div><p>Or</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span> Mongo_URL = <span style="color:#5af78e">&#34;mongodb://localhost:27017&#34;</span>
</span></span></code></pre></div><p>In my case I have used the latter.</p>
<p>Now create a new file named database, and create a database.go file in it with the following content</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> database
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/mongo&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/mongo/options&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">ConnectDB</span>() <span style="color:#ff6ac1">*</span>mongo.Client {
</span></span><span style="display:flex;"><span>	Mongo_URL <span style="color:#ff6ac1">:=</span> <span style="color:#5af78e">&#34;mongodb://localhost:27017&#34;</span>
</span></span><span style="display:flex;"><span>	client, err <span style="color:#ff6ac1">:=</span> mongo.<span style="color:#57c7ff">NewClient</span>(options.<span style="color:#57c7ff">Client</span>().<span style="color:#57c7ff">ApplyURI</span>(Mongo_URL))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#57c7ff">Fatal</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ctx, cancel <span style="color:#ff6ac1">:=</span> context.<span style="color:#57c7ff">WithTimeout</span>(context.<span style="color:#57c7ff">Background</span>(), <span style="color:#ff9f43">10</span><span style="color:#ff6ac1">*</span>time.Second)
</span></span><span style="display:flex;"><span>	err = client.<span style="color:#57c7ff">Connect</span>(ctx)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> <span style="color:#57c7ff">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#57c7ff">Fatal</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	fmt.<span style="color:#57c7ff">Println</span>(<span style="color:#5af78e">&#34;connected to mongodb&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> client
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The ConnectDB function establishes a connection with the DB and returns a new MongoDB Client object.</p>
<p><strong>IMPORTANT NOTE:</strong>
It&rsquo;s best practice to hide environment variables like the database connection string in a .env file using the dotenv package. For tutorial purposes we will not be doing this.</p>
<h1 id="create-database-collection">Create Database Collection</h1>
<p>Mongo stores data in collections which is a way to interface with the underlying DB.</p>
<p>Make a new folder, called Collection in your project root. Now create a new Go file, getCollection.go.</p>
<p>This will be short.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> getcollection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/mongo&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">GetCollection</span>(client <span style="color:#ff6ac1">*</span>mongo.Client, collectionName <span style="color:#9aedfe">string</span>) <span style="color:#ff6ac1">*</span>mongo.Collection {
</span></span><span style="display:flex;"><span>	collection <span style="color:#ff6ac1">:=</span> client.<span style="color:#57c7ff">Database</span>(<span style="color:#5af78e">&#34;DB1&#34;</span>).<span style="color:#57c7ff">Collection</span>(<span style="color:#5af78e">&#34;Post&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">return</span> collection
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>All this code does is return the collection thats requested as shown in the codeblock</p>
<pre tabindex="0"><code>collection := client.Database(&#34;DB1&#34;).Collection(&#34;Post&#34;)
</code></pre><p>So here its returning the collection &ldquo;Post&rdquo; from &ldquo;DB1&rdquo;.</p>
<h1 id="create-the-database-model">Create the Database model</h1>
<p>Make the model folder in project root. Create a file named model.go in it.
Your model in this case is a blog post with its title.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> model
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> <span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson/primitive&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">type</span> Post <span style="color:#ff5c57">struct</span> {
</span></span><span style="display:flex;"><span>	ID      primitive.ObjectID
</span></span><span style="display:flex;"><span>	Title   <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>	Article <span style="color:#9aedfe">string</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This just defines what kind of data we will be putting into the DB.</p>
<h1 id="creating-the-crud-api">Creating the CRUD API</h1>
<p>Now we move onto actually defining the routes and their functionalities.</p>
<p>Create a file named routes. Inside it create 4 go files as shown:</p>
<pre tabindex="0"><code>routes
    ├── create.go
    ├── delete.go
    ├── read.go
    └── update.go
</code></pre><h1 id="create-endpoint">CREATE endpoint</h1>
<p>Creation of an entry in the DB is done by a <code>POST</code> request. We could say that we are quite literally posting a request to our DB.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> routes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>	getcollection <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/Collection&#34;</span>
</span></span><span style="display:flex;"><span>	database <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/databases&#34;</span>
</span></span><span style="display:flex;"><span>	model <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/model&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson/primitive&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">CreatePost</span>(c <span style="color:#ff6ac1">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> DB = database.<span style="color:#57c7ff">ConnectDB</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> postCollection = getcollection.<span style="color:#57c7ff">GetCollection</span>(DB, <span style="color:#5af78e">&#34;Posts&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ctx, cancel <span style="color:#ff6ac1">:=</span> context.<span style="color:#57c7ff">WithTimeout</span>(context.<span style="color:#57c7ff">Background</span>(), <span style="color:#ff9f43">10</span><span style="color:#ff6ac1">*</span>time.Second)
</span></span><span style="display:flex;"><span>	post <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">new</span>(model.Post)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> <span style="color:#57c7ff">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">:=</span> c.<span style="color:#57c7ff">BindJSON</span>(<span style="color:#ff6ac1">&amp;</span>post); err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusBadRequest, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: err})
</span></span><span style="display:flex;"><span>		log.<span style="color:#57c7ff">Fatal</span>(err)
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	postPayload <span style="color:#ff6ac1">:=</span> model.Post{
</span></span><span style="display:flex;"><span>		ID:      primitive.<span style="color:#57c7ff">NewObjectID</span>(),
</span></span><span style="display:flex;"><span>		Title:   post.Title,
</span></span><span style="display:flex;"><span>		Article: post.Article,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	result, err <span style="color:#ff6ac1">:=</span> postCollection.<span style="color:#57c7ff">InsertOne</span>(ctx, postPayload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusInternalServerError, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: err})
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	c.<span style="color:#57c7ff">JSON</span>(
</span></span><span style="display:flex;"><span>		http.StatusCreated,
</span></span><span style="display:flex;"><span>		gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: <span style="color:#5af78e">&#34;Posted Successfully&#34;</span>, <span style="color:#5af78e">&#34;Data&#34;</span>: <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#ff5c57">interface</span>{}{<span style="color:#5af78e">&#34;data&#34;</span>: result}},
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The most important thing you need to understand about this code is that <code>c.BindJSON(&quot;post&quot;)</code> is a &lsquo;JSONified&rsquo; model instance that calls each model field as postPayload; this goes into the database.</p>
<p>Basically, remember that model we defined before? We use that to shape our request. This is the entire crux of the api we are building. It allows us to help the DB and request sender communicate with each other.</p>
<h1 id="read-endpoint">Read endpoint</h1>
<p>This is the code for the <code>READ</code> endpoint. This is done via a <code>GET</code> request.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> routes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>	getCollection <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/Collection&#34;</span>
</span></span><span style="display:flex;"><span>	database <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/databases&#34;</span>
</span></span><span style="display:flex;"><span>	model <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/model&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson/primitive&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">ReadOnePost</span>(c <span style="color:#ff6ac1">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>	ctx, cancel <span style="color:#ff6ac1">:=</span> context.<span style="color:#57c7ff">WithTimeout</span>(context.<span style="color:#57c7ff">Background</span>(), <span style="color:#ff9f43">10</span><span style="color:#ff6ac1">*</span>time.Second)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> DB = database.<span style="color:#57c7ff">ConnectDB</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> postCollection = getCollection.<span style="color:#57c7ff">GetCollection</span>(DB, <span style="color:#5af78e">&#34;Posts&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	postId <span style="color:#ff6ac1">:=</span> c.<span style="color:#57c7ff">Param</span>(<span style="color:#5af78e">&#34;postId&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> result model.Post
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> <span style="color:#57c7ff">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	objId, _ <span style="color:#ff6ac1">:=</span> primitive.<span style="color:#57c7ff">ObjectIDFromHex</span>(postId)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	err <span style="color:#ff6ac1">:=</span> postCollection.<span style="color:#57c7ff">FindOne</span>(ctx, bson.M{<span style="color:#5af78e">&#34;id&#34;</span>: objId}).<span style="color:#57c7ff">Decode</span>(<span style="color:#ff6ac1">&amp;</span>result)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	res <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#ff5c57">interface</span>{}{<span style="color:#5af78e">&#34;data&#34;</span>: result}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusInternalServerError, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: err})
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	c.<span style="color:#57c7ff">JSON</span>(http.StatusCreated, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: <span style="color:#5af78e">&#34;Success!&#34;</span>, <span style="color:#5af78e">&#34;Data&#34;</span>: res})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>postId</code> variable is a parameter declaration(these are also called query strings). It gets a document&rsquo;s object ID as <code>objId</code> as shown in the line</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>objId, _ <span style="color:#ff6ac1">:=</span> primitive.<span style="color:#57c7ff">ObjectIDFromHex</span>(postId)
</span></span></code></pre></div><h1 id="update-endpoint">Update endpoint</h1>
<p>Now its time to use a <code>PUT</code> request. This is similar to how we created an entry in our DB. This time we update an existing entry using its unique object ID using our <code>PUT</code> request.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> routes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>	getcollection <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/Collection&#34;</span>
</span></span><span style="display:flex;"><span>	database <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/databases&#34;</span>
</span></span><span style="display:flex;"><span>	model <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/model&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson/primitive&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">UpdatePost</span>(c <span style="color:#ff6ac1">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>	ctx, cancel <span style="color:#ff6ac1">:=</span> context.<span style="color:#57c7ff">WithTimeout</span>(context.<span style="color:#57c7ff">Background</span>(), <span style="color:#ff9f43">10</span><span style="color:#ff6ac1">*</span>time.Second)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> DB = database.<span style="color:#57c7ff">ConnectDB</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> postCollection = getcollection.<span style="color:#57c7ff">GetCollection</span>(DB, <span style="color:#5af78e">&#34;Post&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	postId <span style="color:#ff6ac1">:=</span> c.<span style="color:#57c7ff">Param</span>(<span style="color:#5af78e">&#34;postId&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> post model.Post
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> <span style="color:#57c7ff">cancel</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	objId, _ <span style="color:#ff6ac1">:=</span> primitive.<span style="color:#57c7ff">ObjectIDFromHex</span>(postId)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">:=</span> c.<span style="color:#57c7ff">BindJSON</span>(<span style="color:#ff6ac1">&amp;</span>post); err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusInternalServerError, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: err})
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	edited <span style="color:#ff6ac1">:=</span> bson.M{<span style="color:#5af78e">&#34;title&#34;</span>: post.Title, <span style="color:#5af78e">&#34;article&#34;</span>: post.Article}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	result, err <span style="color:#ff6ac1">:=</span> postCollection.<span style="color:#57c7ff">UpdateOne</span>(ctx, bson.M{<span style="color:#5af78e">&#34;id&#34;</span>: objId}, bson.M{<span style="color:#5af78e">&#34;$set&#34;</span>: edited})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	res <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#ff5c57">interface</span>{}{<span style="color:#5af78e">&#34;data&#34;</span>: result}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusInternalServerError, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: err})
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> result.MatchedCount &lt; <span style="color:#ff9f43">1</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusInternalServerError, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: <span style="color:#5af78e">&#34;Data doesn&#39;t exist&#34;</span>})
</span></span><span style="display:flex;"><span>		<span style="color:#ff6ac1">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	c.<span style="color:#57c7ff">JSON</span>(http.StatusCreated, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: <span style="color:#5af78e">&#34;data updated!&#34;</span>, <span style="color:#5af78e">&#34;Data&#34;</span>: res})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>A JSON format of the model instance (which is post here) calls each model field from the database. The result variable uses the MongoDB $set operator to update a required document called by its object ID.</p>
<p>The <code>result.MatchedCount</code> condition prevents the code from running if there&rsquo;s no record in the database or the passed ID is invalid.</p>
<h1 id="delete-endpoint">Delete endpoint</h1>
<p>Finally we have the delete endpoint. It removes an entry based on object ID passed as URL parameter</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> routes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>	getcollection <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/Collection&#34;</span>
</span></span><span style="display:flex;"><span>	database <span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/databases&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;go.mongodb.org/mongo-driver/bson/primitive&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">DeletePost</span>(c <span style="color:#ff6ac1">*</span>gin.Context) {
</span></span><span style="display:flex;"><span>	ctx, cancel <span style="color:#ff6ac1">:=</span> context.<span style="color:#57c7ff">WithTimeout</span>(context.<span style="color:#57c7ff">Background</span>(), <span style="color:#ff9f43">10</span><span style="color:#ff6ac1">*</span>time.Second)
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> DB = database.<span style="color:#57c7ff">ConnectDB</span>()
</span></span><span style="display:flex;"><span>	postId <span style="color:#ff6ac1">:=</span> c.<span style="color:#57c7ff">Param</span>(<span style="color:#5af78e">&#34;postId&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff5c57">var</span> postCollection = getcollection.<span style="color:#57c7ff">GetCollection</span>(DB, <span style="color:#5af78e">&#34;Posts&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">defer</span> <span style="color:#57c7ff">cancel</span>()
</span></span><span style="display:flex;"><span>	objId, _ <span style="color:#ff6ac1">:=</span> primitive.<span style="color:#57c7ff">ObjectIDFromHex</span>(postId)
</span></span><span style="display:flex;"><span>	result, err <span style="color:#ff6ac1">:=</span> postCollection.<span style="color:#57c7ff">DeleteOne</span>(ctx, bson.M{<span style="color:#5af78e">&#34;id&#34;</span>: objId})
</span></span><span style="display:flex;"><span>	res <span style="color:#ff6ac1">:=</span> <span style="color:#ff5c57">map</span>[<span style="color:#9aedfe">string</span>]<span style="color:#ff5c57">interface</span>{}{<span style="color:#5af78e">&#34;data&#34;</span>: result}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusInternalServerError, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: err})
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		c.<span style="color:#57c7ff">JSON</span>(http.StatusInternalServerError, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: <span style="color:#5af78e">&#34;No data to delete&#34;</span>})
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	c.<span style="color:#57c7ff">JSON</span>(http.StatusCreated, gin.H{<span style="color:#5af78e">&#34;message&#34;</span>: <span style="color:#5af78e">&#34;Article deleted successfully&#34;</span>, <span style="color:#5af78e">&#34;Data&#34;</span>: res})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This code deletes a record using the <code>DeleteOne</code> function. The result.DeletedCount property helps us check if the DB is empty or requested object ID is invalid.</p>
<h1 id="creating-the-api-runner-file">Creating the API runner file</h1>
<p>Now in <code>main.go</code> add the following code. This will handle the router execution for each endpoint.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff6ac1">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#5af78e">&#34;github.com/sid-008/monGoCRUD/routes&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">func</span> <span style="color:#57c7ff">main</span>() {
</span></span><span style="display:flex;"><span>	router <span style="color:#ff6ac1">:=</span> gin.<span style="color:#57c7ff">Default</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	router.<span style="color:#57c7ff">POST</span>(<span style="color:#5af78e">&#34;/&#34;</span>, routes.CreatePost)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	router.<span style="color:#57c7ff">GET</span>(<span style="color:#5af78e">&#34;/getOne/:postId&#34;</span>, routes.ReadOnePost)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	router.<span style="color:#57c7ff">PUT</span>(<span style="color:#5af78e">&#34;/update/:postId&#34;</span>, routes.UpdatePost)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	router.<span style="color:#57c7ff">DELETE</span>(<span style="color:#5af78e">&#34;/delete/:postId&#34;</span>, routes.DeletePost)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	err <span style="color:#ff6ac1">:=</span> router.<span style="color:#57c7ff">Run</span>(<span style="color:#5af78e">&#34;localhost: 3000&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#ff6ac1">if</span> err <span style="color:#ff6ac1">!=</span> <span style="color:#ff6ac1">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#57c7ff">Fatal</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now you can run the server by typing the following command in your project root</p>
<pre tabindex="0"><code>$ go run main.go
</code></pre><p>There you have it! A fully working mongoDB + Go CRUD API</p>
<p>You can test the API using the curl command, postman or insomnia.</p>

    
  </div>

  


  

  
  

<div class="single-pagination">
    <hr />

    <div class="flex">

        <div class="single-pagination-prev">
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/tech/init/">
                        A brief history of init systems
                    </a>
                </div>
                <div class="single-pagination-text">→</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


      </main>
    </div>

    <footer>
      

    
    
    
    <p>Perpetually Curious</p>
    



    </footer>
    
  </body>

  <script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

</html>